version: 3

projects:
- name: stage-project
  dir: .
  # Надо запускать планирование и аплай для двух воркспейса stage.
  workspace: stage
  autoplan:
    # Необходимо включить автопланирование при изменении любых файлов *.tf.
    when_modified: ["*.tf*"]
  workflow: dev-wf
- dir: .
  # Надо запускать планирование и аплай для двух воркспейса prod.
  workspace: prod
  autoplan:
    # Необходимо включить автопланирование при изменении любых файлов *.tf.
    when_modified: ["*.tf*"]
  workflow: dev-wf
workflows:
  dev-wf:
    plan:
      steps:
        - init
        - plan
    apply:
      steps:
        - apply