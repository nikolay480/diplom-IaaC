version: 3

projects:
- dir: .
  # Надо запускать планирование и аплай для двух воркспейса stage.
  workspace: stage
  autoplan:
    # Необходимо включить автопланирование при изменении любых файлов *.tf.
    when_modified: ["*.tf*"]
  workflow: default
- dir: .
  # Надо запускать планирование и аплай для двух воркспейса prod.
  workspace: prod
  autoplan:
    # Необходимо включить автопланирование при изменении любых файлов *.tf.
    when_modified: ["*.tf*"]
  workflow: default
workflows:
  default:
    plan:
      steps:
        - init
        - plan
    apply:
      steps:
        - apply